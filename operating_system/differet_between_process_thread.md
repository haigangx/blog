# 进程和线程区别

**核心：进程是资源分配的最小单位，线程是CPU调度的最小单位**

- 进程：
  
  - 进程是资源竞争的基本单位，比如竞争CPU的调度，以及申请内存（物理地址空间）
  - 进程之间相互独立安全性高，如果两个进程之间需要进行（事件通知，数据传输，资源共享，进程控制）那么就需要通过进程间通信（管道，消息队列，共享内存，信号量等）的方式来达成。
  - 进程有自己的内存，通过分页将虚拟地址空间映射到物理地址空间来存储数据 

- 线程：
  
  - 线程是程序运行的最小单位，线程是进程的一个分流（一个进程至少有一个线程）
  - 一个进程内部的多个线程之间共享进程的数据，如果多个线程同时访问临界资源就会存在线程冲突（通过互斥锁来放置线程访问共享资源冲突的问题，有的时候互斥锁会带“死锁”和“饥饿现象”的问题），当然大多数线程内部的数据是单独享有的存储在线程栈上面。
  - 线程共享进程的虚拟地址空间（共享段、数据段）、用户ID和组ID、文件描述符表、当前工作目录、但是线程也私有自己的一部分数据例如一组寄存器（用于线程切换时保存独立硬件上下）、用户栈（保存私有数据）、线程优先级等。

**理解：**
- 资源管理角度：

  资源即计算机里的中央处理器、内存、文件、网络等
  
  进程可以理解为在一定环境下，把静态的程序代码运行起来，通过使用不同的资源来完成一定的任务
  
  进程的环境包括：环境变量、进程掌握的资源：中央处理器、内存、打开的文件、映射的网络端口等


  线程作为进程的一部分，扮演的角色是怎么利用中央处理器去运行代码，线程关注的是中央处理器的运行，而不是其他内存等资源的管理
  
  当只有一个中央处理器时，进程中只需要一个线程，随着多处理器的发展，一个进程可以有多个线程来并行的完成任务
  
  进程和线程不是同一层面的概念，线程是进程的一部分，线程主抓中央处理器执行代码的过程，其余的资源保护和管理由整个进程完成

- CPU任务切换角度：

  CPU轮流执行任务的过程：先加载程序A的上下文，然后开始执行A，保存程序A的上下文，调入下一个要执行的程序B的程序上下文，然后执行B，保存程序B的上下文
  
  所以： 进程就是包括上下文切换的程序执行时间总和 = CPU加载上下文 + CPU执行 + CPU保存上下文
  
  进程的颗粒度太大，每次都要有上下文的调入、保存、调出
  
  如果将进程分为a,b,c三个线程组合而成，执行流程将变为：
  
  程序A得到CPU -> CPU加载上下文 -> 执行程序A的a -> 执行b -> 执行c ->保存A的上下文
  
  也即，线程共享进程的上下文，使得线程切换导致的上下文切换代价更小，是更为细小的CPU时间段
  
  总结：进程和线程都是一个时间段的描述，是CPU工作时间段的描述，不过是颗粒大小不同

- 计算机发展史角度：

  早期计算机只有进程，进程是最基本的运行单位，包含静态的资源和动态的计算，随着计算机性能的提升和系统设计的改进，为了避免进程间调度带来的资源开销，同时提升系统的并发性能，于是在进程中引入了线程的概念，专门来负责程序的动态部分
  
  总之：
  
  - 进程是一个资源的容器，为进程里所有线程提供共享资源，是对程序的一种静态描述
  
  - 线程是计算机最小的调度和运行单位，是对程序的一种动态描述

- 从程序角度：

  - 定义方面：进程是程序在某个数据集合上的一次运行活动；线程是进程中的一个执行路径
  - 角色方面：在支持线程机制的系统中，进程是系统资源分配的单位，线程是系统调度的单位
  - 资源共享方面：进程之间不能共享资源，而线程共享所在进程的地址空间和其它资源。同时线程还有自己的栈和栈指针，程序计数器等寄存器
  - 独立性方面：进程有自己独立的地址空间，而线程没有，线程必须依赖于进程而存在
