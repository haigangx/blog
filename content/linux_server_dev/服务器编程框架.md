# 服务器编程框架

不同种类的服务器其基本框架都一样，基本框架如下图：

![服务器基本框架](doc/server_basic.png)

上图既能描述一台服务器，也能用来描述一个服务器集群，下表描述服务器基本模块的功能描述：

| 模块 | 单个服务器程序 | 服务器集群 |
| --- | --- | --- |
| I/O处理单元 | 处理客户连接，读写网络数据 | 作为接入服务器，实现负载均衡 |
| 逻辑单元 | 业务进程或线程 | 逻辑服务器 |
| 网络存储单元 | 本地数据库、文件和缓存 | 数据库服务器 |
| 请求队列 | 各单元之间的通信方式 | 各服务器之间的永久TCP连接 |

- I/O处理单元：

    服务器管理客户连接的模块。它通常完成的工作是：等待并接受新的客户连接，接收客户数据，将服务器响应数据返回给客户端。但是数据的收发不一定在I/O处理单元中执行，也有可能在逻辑单元中执行，具体在何处执行取决于事件处理模式

    对于一个服务器集群来说，I/O处理单元是一个专门的接入服务器。它实现负载均衡，从所有逻辑服务器中选取负荷最小的一台来为新客户服务

- 逻辑单元：

    通常是一个进程或者线程。它分析并处理客户数据，然后将结果传递给I/O处理单元或者直接发送给客户端

    对服务器集群来说，一个逻辑单元就是一台逻辑服务器。服务器通常拥有多个逻辑单元，以实现对多个客户任务的并行处理

- 网络存储单元：

    网络存储单元可以是数据库、缓存和文件，甚至是一台独立的服务器。但它不是必须的，比如ssh、telnet等登录服务就不需要这个单元

- 请求队列：

    各单元之间的通信方式的抽象。I/O处理单元接收到客户请求时，需要以某种方式通知一个逻辑单元来处理请求。同样，多个逻辑单元同时访问一个存储单元时，也需要采用某种机制来协调处理竞态条件。请求队列通常被视为池的一部分

    对服务器集群来说，请求队列是各台服务器之间预先建立起来的、静态的、永久的TCP连接。这种TCP连接能提高服务器之间交换数据的效率，因为它避免了动态建立TCP连接导致的额外的系统开销

