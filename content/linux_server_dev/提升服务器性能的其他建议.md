# 提高服务器性能的其他建议

## 池：

- 内存池：例：socket的接受和发送缓冲

- 进程池和线程池：并发编程

- 连接池：服务器或者集群的内部永久连接

    以数据库连接为例：

    通常的做法是逻辑单元每次需要访问数据库的时候，就向数据库程序发起连接，而访问完毕后释放连接；

    使用连接池的做法是服务器预先和数据库程序建立的一组连接的集合。当某个逻辑单元需要访问数据库时，它可以直接从连接池中取得一个连接的实体并使用之，待完成数据库的访问之后，逻辑单元再次将该连接返还给连接池.

## 数据复制

高性能服务器应该避免不必要的数据复制，可以使用的方法有：

- 零拷贝函数代替普通函数：如零拷贝场景适用下尽量sendfile替代send
- 使用共享内存代替管道或消息队列在两个进程间传递大量数据
- 尽可能使用缓冲区指针传递代替传递整个缓冲区内容

## 上下文切换和锁

并发程序必须考虑上下文切换(context switch)问题，即进程切换或线程切换导致的系统开销，过多的进程数将导致上下文切换的开销增大，所以要协调进程数和服务器性能之间的关系

并发程序需要引入锁来对共享资源进行访问保护，锁同时会引起性能底下的问题，所以尽可能避免使用锁，或者保证锁的粒度尽可能的小

